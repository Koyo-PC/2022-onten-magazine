---
title: VRChatでめちゃくちゃリアルな星空を作った話
author: ZOI
---

またまたこんにちは、ZOIです。
VRで見れるめちゃくちゃリアルな星空を作ってみたので、その話をしていきます。

## 1. 星の再現

さて、星空を作るということで、まず星が必要です。
星空の画像を撮ってきて貼ればいいんですが、それだと面白くないですよね〜。
(あと綺麗に撮れない)
というわけでせっかくなので、現実の星のデータを使って星を表示してみようと思います!
星のデータをWikipediaかどこかで一つずつ調べていくと死んでしまうので、ESA(ヨーロッパ宇宙機関)がまとめてくれた便利なデータを使います。
今回使うのは`Hipparcos`、`Gaia`という2つの衛星で観測されたものにします。
それぞれHipparcos星表、Gaia星表と呼ぶことにすると、Hipparcos星表は主に明るい星(12等星以上)、Gaia星表は暗い星(20等星以上)の情報を含んでいます。
このデータを使ってどのように星を表示するか考えましょう。
もちろん星を一つ一つ3Dデータとして表示するのでもいいのですが、さっき紹介したHipparcos星表は約12万、Gaia星表は約18億の星のデータがあります。
こんなものを3Dデータとして使ってしまうと、たとえ星を1ポリゴンで表せたとしても、18億ポリゴンになってしまいます。
これをOBJ形式(3Dモデル)で表した場合、少なめに(1ポリゴン=50バイトで)見積もっても90GiBになります。
現実的じゃないです。
そこで、画像として星空を用意しておいて、それを球に貼り付けて表示することにしましょう。

### a. 画像の作成

というわけで、Gaia星表とHipparcos星表から星空を描くプログラムを作ります。
しかし、一回自分で作ってみて一応完成したのですが、出力するとどう見てもミスってました。天文の知識がなさすぎて、一体どこが間違っているのかよくわからん。
それだけで部誌5000文字くらい書いてたけど、治すのは~~めんどくさそう~~難しそうだったので、とりあえず自分で作るのは諦めました。

そこで「Gaia・Hipparcos星表を使って星空を描くアプリないかな〜」とか思いながらWebの海を彷徨っていたところ、なんとありました!(なんであるの???)
こちらのプロジェクトです。
(GitHubってのは「エンジニア版のPixiv」って言われてたりします。宝の山。)

<https://github.com/misohena/drawstars>

しかし、このコードを動かすだけなら簡単すぎるので、ちょっと手を加えてみます。
実は、このプロジェクトが作られた後に、「Gaia EDR3」っていうGaia星表の新バージョンが作られてるんです。
僕としてはEDR3の方で描きたかったので、EDR3への対応をしていきます。
GitHubってのは一種のSNSなのですが、「他人が作ったプロジェクトに勝手に派生作品を作る」っていう謎機能があります。
(Fork。Twitterのリツイートに近い?)
この機能をありがたく使わせてもらいます。
派生先リンクはこれです。

<https://github.com/ZOI-dayo/drawstars_GaiaDR3>

ただ、元のコードがしっかりしてるので、リンクの変更以外あんまり変更するところはなかったです。強いて言えば、元々使ってあるGaia DR2というバージョンでは星の表面温度が取得できるのですが、Gaia EDR3にはそれがなさそうです。
(なんで消した...?)
なので、それっぽい論文(<https://arxiv.org/pdf/1008.0815.pdf>)にある式$\log (T_{eff}) = 3.999 - 0.654 (C_{XP}) + 0.709 (C_{XP})^2 − 0.316(C_{XP})^3$を使って捻り出しました。
誤差はあるようですが、星の色が目に見えて変わるほどではないはず...

あとの使い方はmisohenaさんのプロジェクトと全く同じです。
なんやかんやしてできた画像がこちら。

<!-- ![](https://github.com/ZOI-dayo/VRCStarWorld/blob/main/Assets/Stars/output.png?raw=true) -->

どう見ても星空ですね。
天の川がぐにゃぐにゃなのは正距円筒図法という書き方だからです。
詳しくはGoogleさんに聞きましょう。

なお星空画像が欲しいという方は、謎コードを書いたり600GBのダウンロードをしたりするような変な真似はせずに、おとなしく下のサイトからダウンロードしましょう。
<http://t.nomoto.org/AllSkyHipp2GAIA/>

### b. 3D空間に設置

目的は綺麗な星空が見えるVRChatワールドを作ることなので、早速ワールドにしていきます。

VRChatって何?という方のために解説。
VRChatとは、VRゴーグルを使ったSNSの一つです。
他にも似たようなサービスは多くあるのですが、自分でアバターやワールドを作るときの自由度が特徴なんじゃないかと思います。

もちろん多くの人はVRゴーグルなんて持っていないと思うので、アプリとしても配布します!

VRChatでワールドを作るときはUnityというゲーム開発エンジンを使います。
現状「Unity 2019.4.31f1」が使えるそうなのでそのバージョンを入れましょう。(参考: <https://docs.vrchat.com/docs/current-unity-version>)
インストール方法などはこのページに書いてあるので省きます。
